<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ƒê·∫•u tranh ch·ªëng Gi·∫∑c n·ªôi x√¢m</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800;900&family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        heading: ['Montserrat', 'sans-serif'],
                        body: ['Be Vietnam Pro', 'sans-serif'],
                    },
                    colors: {
                        revolution: '#D71920',
                        gold: '#FFFF00',
                        worker: '#0055A4',
                        concrete: '#959595',
                        enemy: '#D32F2F',
                        ally: '#2E7D32',
                        construction: '#E65100',
                        steel: '#455A64',
                    },
                    boxShadow: {
                        clay: '6px 6px 0 0 rgba(0, 0, 0, 0.15), inset -3px -3px 0 rgba(255, 255, 255, 0.3)',
                        'clay-sm': '4px 4px 0 0 rgba(0, 0, 0, 0.12), inset -2px -2px 0 rgba(255, 255, 255, 0.25)',
                        'clay-pressed': '2px 2px 0 0 rgba(0, 0, 0, 0.1), inset 2px 2px 4px rgba(0, 0, 0, 0.1)',
                    },
                    borderRadius: {
                        'blob': '60% 40% 50% 50% / 50% 60% 40% 50%',
                    },
                },
            },
        };
    </script>
    <style>
        /* Touch and mobile optimizations */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        body {
            background: linear-gradient(180deg, #FFE0B2 0%, #FFCC80 30%, #FFB74D 60%, #FFA726 100%);
            min-height: 100vh;
            min-height: 100dvh;
            touch-action: manipulation;
            overscroll-behavior: none;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><rect x="8" y="2" width="4" height="16" fill="%238B4513" stroke="%23654321" stroke-width="1"/><rect x="4" y="18" width="12" height="8" rx="2" fill="%23455A64" stroke="%23263238" stroke-width="1.5"/><rect x="6" y="20" width="8" height="4" fill="%2378909C"/></svg>') 6 26, pointer;
        }
        .hole {
            position: relative;
            overflow: hidden;
            isolation: isolate;
            touch-action: manipulation;
        }
        .hole::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(ellipse at 50% 30%, rgba(255, 255, 255, 0.4), transparent 50%);
            pointer-events: none;
        }
        /* Entity System Styles */
        /* Mobile-first entity sizing */
        .entity {
            position: absolute;
            bottom: -100%;
            left: 50%;
            transform: translateX(-50%);
            width: 52px;
            height: 56px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            pointer-events: none;
            z-index: 10;
        }
        .entity-face {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid currentColor;
            box-shadow: 
                0 2px 4px rgba(0,0,0,0.25),
                inset 0 -2px 0 rgba(0,0,0,0.1);
        }
        .entity-face svg {
            width: 18px;
            height: 18px;
        }
        .entity-label {
            font-family: 'Montserrat', sans-serif;
            font-size: 0.5rem;
            font-weight: 800;
            color: white;
            padding: 1px 4px;
            border-radius: 3px;
            margin-top: 1px;
            white-space: nowrap;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .hole.is-active .entity {
            animation: entityPop 200ms ease-out forwards;
        }
        /* Enemy styling */
        .hole.is-enemy .entity-face {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            border-color: #c62828;
        }
        /* Ally styling */
        .hole.is-ally .entity-face {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-color: #1b5e20;
        }
        @keyframes entityPop {
            0% { bottom: -100%; transform: translateX(-50%); }
            70% { bottom: 8%; transform: translateX(-50%); }
            100% { bottom: 0%; transform: translateX(-50%); }
        }
        /* Hit effect */
        .hole.is-hit .entity {
            animation: entitySquish 300ms ease-out forwards;
        }
        @keyframes entitySquish {
            0% { transform: translateX(-50%) scale(1, 1); bottom: 0%; }
            30% { transform: translateX(-50%) scale(1.2, 0.7); bottom: -5%; }
            100% { transform: translateX(-50%) scale(1, 1); bottom: -100%; }
        }
        /* Impact burst effect - mobile-first */
        .impact-burst {
            position: absolute;
            pointer-events: none;
            z-index: 20;
        }
        .impact-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: particlePop 400ms ease-out forwards;
        }
        @media (min-width: 640px) {
            .impact-particle {
                width: 10px;
                height: 10px;
            }
        }
        @media (min-width: 1024px) {
            .impact-particle {
                width: 12px;
                height: 12px;
            }
        }
        @keyframes particlePop {
            0% { opacity: 1; transform: scale(0) translate(0, 0); }
            50% { opacity: 1; transform: scale(1.2) translate(var(--tx), var(--ty)); }
            100% { opacity: 0; transform: scale(0.6) translate(calc(var(--tx) * 1.5), calc(var(--ty) * 1.5 - 20px)); }
        }
        /* Responsive entity sizing - tablets */
        @media (min-width: 640px) {
            .entity {
                width: 64px;
                height: 68px;
            }
            .entity-face {
                width: 44px;
                height: 44px;
                border-width: 3px;
            }
            .entity-face svg {
                width: 24px;
                height: 24px;
            }
            .entity-label {
                font-size: 0.55rem;
                padding: 2px 5px;
                margin-top: 2px;
            }
        }
        /* Responsive entity sizing - desktop */
        @media (min-width: 1024px) {
            .entity {
                width: 80px;
                height: 88px;
            }
            .entity-face {
                width: 56px;
                height: 56px;
            }
            .entity-face svg {
                width: 30px;
                height: 30px;
            }
            .entity-label {
                font-size: 0.65rem;
                padding: 3px 7px;
            }
        }
        /* Score popup - enhanced, mobile-first */
        .score-popup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
            font-size: 1.25rem;
            pointer-events: none;
            z-index: 25;
            animation: scoreFloat 600ms cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
        @media (min-width: 640px) {
            .score-popup {
                font-size: 1.5rem;
            }
        }
        @media (min-width: 1024px) {
            .score-popup {
                font-size: 1.75rem;
            }
        }
        .score-popup.positive {
            color: #1b5e20;
            text-shadow: 
                0 0 10px rgba(46, 125, 50, 0.5),
                2px 2px 0 #4CAF50, 
                -1px -1px 0 #81C784,
                0 4px 8px rgba(0,0,0,0.2);
        }
        .score-popup.negative {
            color: #b71c1c;
            text-shadow: 
                0 0 10px rgba(211, 47, 47, 0.5),
                2px 2px 0 #F44336, 
                -1px -1px 0 #EF9A9A,
                0 4px 8px rgba(0,0,0,0.2);
        }
        @keyframes scoreFloat {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(0.3) rotate(-10deg); }
            40% { opacity: 1; transform: translate(-50%, -90%) scale(1.4) rotate(5deg); }
            70% { opacity: 1; transform: translate(-50%, -110%) scale(1.1) rotate(-2deg); }
            100% { opacity: 0; transform: translate(-50%, -140%) scale(0.9) rotate(0deg); }
        }
        @media (prefers-reduced-motion: reduce) {
            .hole.is-active .entity,
            .hole.is-hit .entity {
                animation: none !important;
            }
            .hole.is-hit .entity {
                bottom: -100%;
            }
            .impact-particle, .score-popup {
                animation: none;
                opacity: 0;
            }
        }
        /* Mobile-first game layout using dynamic viewport */
        .garden-layout {
            position: relative;
            width: 100%;
            /* Mobile: fill available space minus HUD */
            height: calc(100svh - 180px);
            min-height: 280px;
            max-height: 500px;
        }
        @media (min-width: 640px) {
            .garden-layout {
                height: calc(100svh - 220px);
                min-height: 320px;
                max-height: 450px;
            }
        }
        @media (min-width: 1024px) {
            .garden-layout {
                height: 400px;
                min-height: 400px;
                max-height: 450px;
            }
        }
        .garden-layout .hole {
            position: absolute;
        }
        /* Mobile compact HUD */
        .mobile-hud {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 50;
            padding: 6px 10px;
            padding-bottom: max(6px, env(safe-area-inset-bottom));
            background: linear-gradient(to top, rgba(255,255,255,0.98), rgba(255,255,255,0.95));
            backdrop-filter: blur(8px);
            border-top: 2px solid #D71920;
        }
        @media (min-width: 1024px) {
            .mobile-hud {
                display: none;
            }
        }
        /* Mobile viewport optimization */
        @media (max-width: 1023px) {
            body {
                padding-bottom: 72px;
                min-height: 100dvh;
                overflow-x: hidden;
            }
            /* Hide header text on very small screens */
            .mobile-hide-text {
                display: none;
            }
        }
        @media (max-height: 700px) and (max-width: 1023px) {
            .mobile-compact-header {
                display: none !important;
            }
        }
    </style>
</head>
<body class="min-h-screen text-slate-800 font-body">
    <!-- Construction site decorations -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none hidden lg:block">
        <svg class="absolute top-0 left-[5%] w-20 h-40 opacity-20" viewBox="0 0 60 120">
            <rect x="28" y="20" width="4" height="100" fill="#455A64"/>
            <rect x="0" y="15" width="60" height="4" fill="#455A64"/>
            <rect x="0" y="10" width="4" height="10" fill="#E65100"/>
            <line x1="0" y1="15" x2="30" y2="60" stroke="#78909C" stroke-width="1"/>
        </svg>
        <svg class="absolute top-0 right-[8%] w-16 h-32 opacity-15" viewBox="0 0 60 120">
            <rect x="28" y="20" width="4" height="100" fill="#455A64"/>
            <rect x="0" y="15" width="60" height="4" fill="#455A64"/>
            <rect x="56" y="10" width="4" height="10" fill="#FFFF00"/>
        </svg>
    </div>

    <main class="relative max-w-5xl mx-auto px-2 sm:px-6 lg:px-8 py-2 sm:py-8 space-y-2 sm:space-y-6">
        <!-- Header - Compact on mobile -->
        <header class="text-center space-y-1 sm:space-y-3">
            <div class="mobile-compact-header inline-flex items-center gap-2 px-3 py-0.5 sm:px-4 sm:py-1 bg-revolution/10 border-2 border-revolution/30 rounded-full">
                <svg class="w-4 h-4 sm:w-5 sm:h-5 text-revolution" viewBox="0 0 24 24" fill="currentColor"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></svg>
                <span class="text-xs sm:text-sm font-semibold text-revolution">T∆∞ t∆∞·ªüng H·ªì Ch√≠ Minh</span>
            </div>
            <h1 class="text-xl sm:text-4xl lg:text-5xl font-heading font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-revolution via-construction to-revolution leading-tight">
                CH·ªêNG "GI·∫∂C N·ªòI X√ÇM"
            </h1>
            <p class="text-slate-600 text-sm sm:text-base font-medium hidden sm:block max-w-2xl mx-auto">
                Th·ªùi k·ª≥ qu√° ƒë·ªô l√† cu·ªôc ƒë·∫•u tranh gay go. H√£y lo·∫°i b·ªè Tham √¥, L√£ng ph√≠, Quan li√™u v√† b·∫£o v·ªá c√°c ƒë·ªông l·ª±c c√°ch m·∫°ng!
            </p>
        </header>

        <!-- Mobile: Game board first, then controls -->
        <section class="flex flex-col lg:grid lg:grid-cols-3 gap-4 sm:gap-5 items-stretch">
            <!-- Game Board - FIRST on mobile for focus -->
            <div class="w-full order-1 lg:order-2 lg:col-span-2 space-y-3 sm:space-y-4">
                <!-- Game Board - Construction Site -->
                <div id="game-container" class="relative bg-gradient-to-b from-amber-600 via-amber-700 to-amber-800 border-4 border-amber-900 rounded-[1.5rem] sm:rounded-[2rem] p-3 sm:p-6 shadow-lg overflow-hidden">
                    <!-- Construction texture -->
                    <div class="absolute inset-0 opacity-20 pointer-events-none" style="background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(0,0,0,0.1) 10px, rgba(0,0,0,0.1) 20px);"></div>
                    
                    <!-- Decorative construction elements -->
                    <div class="absolute top-2 left-3 opacity-60 pointer-events-none">
                        <svg class="w-6 h-6 sm:w-8 sm:h-8" viewBox="0 0 24 24" fill="#FFFF00"><path d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71L12 2z"/></svg>
                    </div>
                    <div class="absolute top-3 right-4 opacity-50 pointer-events-none">
                        <svg class="w-5 h-5 sm:w-7 sm:h-7" viewBox="0 0 24 24" fill="#D71920"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></svg>
                    </div>
                    <div id="board" class="garden-layout relative"></div>
                    <p class="mt-2 text-center text-amber-100 text-xs sm:text-sm font-semibold drop-shadow">
                        üî® ƒê·∫≠p "Gi·∫∑c" (ƒë·ªè/x√°m) ‚Ä¢ üõ°Ô∏è B·∫£o v·ªá "ƒê·ªông l·ª±c" (xanh/t√≠m)
                    </p>
                </div>

                <!-- Desktop: Stats and controls below board -->
                <div class="hidden lg:block space-y-4">
                    <!-- Control bar -->
                    <div class="flex flex-wrap items-center justify-between gap-4 bg-white/90 border-4 border-construction rounded-3xl p-4 sm:p-5 shadow-lg">
                        <div class="flex items-center gap-3">
                            <div class="h-14 w-14 rounded-2xl bg-gradient-to-br from-gold to-amber-500 border-4 border-amber-600 grid place-items-center shadow-md">
                                <svg class="w-7 h-7 text-amber-800" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71L12 2z"/></svg>
                            </div>
                            <div>
                                <p class="text-sm text-slate-500 font-medium">S·∫µn s√†ng thi h√†nh?</p>
                                <p class="text-lg font-heading font-bold text-slate-800">Lo·∫°i b·ªè gi·∫∑c n·ªôi x√¢m!</p>
                            </div>
                        </div>
                        <div class="flex gap-3">
                            <button id="start-btn-desktop" class="px-6 py-3 rounded-2xl bg-gradient-to-b from-revolution to-red-700 text-white font-heading text-lg font-bold border-4 border-red-800 shadow-lg hover:shadow-md hover:translate-y-0.5 transition-all duration-150 cursor-pointer focus:outline-none focus:ring-4 focus:ring-red-300">B·∫Øt ƒë·∫ßu!</button>
                            <button id="stop-btn-desktop" class="px-6 py-3 rounded-2xl bg-gradient-to-b from-slate-100 to-slate-200 text-slate-600 font-heading text-lg font-bold border-4 border-slate-300 shadow-lg hover:shadow-md hover:translate-y-0.5 transition-all duration-150 cursor-pointer focus:outline-none focus:ring-4 focus:ring-slate-300">D·ª´ng</button>
                        </div>
                    </div>

                    <!-- Stats -->
                    <div class="grid grid-cols-4 gap-3 text-center">
                        <div class="rounded-2xl bg-white/90 border-4 border-revolution/60 p-4 space-y-1 shadow-lg">
                            <p class="text-slate-500 text-xs font-semibold">Ch·ªâ s·ªë Li√™m ch√≠nh</p>
                            <p id="score-desktop" class="text-3xl font-heading font-bold text-revolution">0</p>
                        </div>
                        <div class="rounded-2xl bg-white/90 border-4 border-ally/80 p-4 space-y-1 shadow-lg">
                            <p class="text-slate-500 text-xs font-semibold">Chu·ªói ƒë√∫ng</p>
                            <p id="streak-desktop" class="text-3xl font-heading font-bold text-ally">0</p>
                        </div>
                        <div class="rounded-2xl bg-white/90 border-4 border-worker/80 p-4 space-y-1 shadow-lg">
                            <p class="text-slate-500 text-xs font-semibold">Th·ªùi gian</p>
                            <p id="time-desktop" class="text-3xl font-heading font-bold text-worker">60</p>
                        </div>
                        <div class="rounded-2xl bg-white/90 border-4 border-gold/60 p-4 space-y-2 shadow-lg">
                            <div class="flex items-center justify-between text-xs">
                                <span class="text-slate-500 font-semibold">L√≤ng d√¢n</span>
                                <span id="health-label-desktop" class="font-bold text-ally">100%</span>
                            </div>
                            <div class="h-3 rounded-full bg-slate-200 overflow-hidden border-2 border-slate-300">
                                <div id="health-bar-desktop" class="h-full bg-gradient-to-r from-ally to-gold w-full transition-all duration-300 rounded-full"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar - Educational Legend -->
            <aside class="order-2 lg:order-1 hidden lg:block space-y-4 bg-white/90 border-4 border-construction rounded-3xl p-5 shadow-lg">
                <h2 class="text-xl font-heading font-bold text-slate-800 flex items-center gap-2">
                    <svg class="w-6 h-6 text-revolution" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                    Th∆∞ vi·ªán L√Ω lu·∫≠n
                </h2>
                
                <!-- Legend -->
                <div class="space-y-2">
                    <p class="text-xs font-bold text-slate-500 uppercase tracking-wider">Gi·∫∑c n·ªôi x√¢m (ƒê·∫≠p!)</p>
                    <div class="flex flex-wrap gap-2">
                        <span class="px-2 py-1 bg-enemy/20 text-enemy text-xs font-bold rounded-lg border border-enemy/40">Tham √¥</span>
                        <span class="px-2 py-1 bg-construction/20 text-construction text-xs font-bold rounded-lg border border-construction/40">L√£ng ph√≠</span>
                        <span class="px-2 py-1 bg-steel/20 text-steel text-xs font-bold rounded-lg border border-steel/40">Quan li√™u</span>
                    </div>
                </div>
                <div class="space-y-2">
                    <p class="text-xs font-bold text-slate-500 uppercase tracking-wider">ƒê·ªông l·ª±c (B·∫£o v·ªá!)</p>
                    <div class="flex flex-wrap gap-2">
                        <span class="px-2 py-1 bg-ally/20 text-ally text-xs font-bold rounded-lg border border-ally/40">ƒêo√†n k·∫øt</span>
                        <span class="px-2 py-1 bg-worker/20 text-worker text-xs font-bold rounded-lg border border-worker/40">D√¢n ch·ªß</span>
                        <span class="px-2 py-1 bg-purple-600/20 text-purple-600 text-xs font-bold rounded-lg border border-purple-600/40">Khoa h·ªçc</span>
                    </div>
                </div>
                
                <!-- Rules -->
                <ul class="space-y-2 text-slate-600 text-sm font-medium">
                    <li class="flex items-start gap-2">
                        <span class="inline-block w-2 h-2 mt-1.5 rounded-full bg-ally flex-shrink-0"></span>
                        ƒê·∫≠p gi·∫∑c: <strong class="text-ally">+10 ƒëi·ªÉm</strong>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="inline-block w-2 h-2 mt-1.5 rounded-full bg-enemy flex-shrink-0"></span>
                        ƒê·∫≠p nh·∫ßm ƒë·ªông l·ª±c: <strong class="text-enemy">-20 ƒëi·ªÉm</strong>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="inline-block w-2 h-2 mt-1.5 rounded-full bg-steel flex-shrink-0"></span>
                        B·ªè l·ªçt gi·∫∑c: <strong class="text-steel">-5 ƒëi·ªÉm</strong>
                    </li>
                </ul>
                
                <div class="p-4 rounded-2xl bg-gradient-to-br from-gold/30 via-construction/20 to-revolution/20 border-3 border-amber-400 shadow-md">
                    <p class="text-sm text-slate-500 font-semibold">Tr·∫°ng th√°i</p>
                    <p id="status" class="text-base font-heading font-bold text-slate-800" aria-live="polite">Nh·∫•n "B·∫Øt ƒë·∫ßu" ƒë·ªÉ thi h√†nh nhi·ªám v·ª•!</p>
                </div>
            </aside>
        </section>
    </main>

    <!-- Mobile HUD - Fixed bottom bar -->
    <div class="mobile-hud lg:hidden">
        <div class="flex items-center justify-between gap-2">
            <!-- Stats -->
            <div class="flex items-center gap-2">
                <div class="flex items-center gap-1 bg-revolution/20 px-2.5 py-1.5 rounded-xl border-2 border-revolution/40">
                    <svg class="w-4 h-4 text-revolution" viewBox="0 0 24 24" fill="currentColor"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></svg>
                    <span id="score" class="text-lg font-heading font-bold text-revolution">0</span>
                </div>
                <div class="flex items-center gap-1 bg-worker/20 px-2.5 py-1.5 rounded-xl border-2 border-worker/40">
                    <svg class="w-4 h-4 text-worker" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                    <span id="time" class="text-lg font-heading font-bold text-worker">60</span>
                </div>
                <div class="flex items-center gap-1 bg-ally/20 px-2.5 py-1.5 rounded-xl border-2 border-ally/40">
                    <span class="text-xs">üî•</span>
                    <span id="streak" class="text-lg font-heading font-bold text-ally">0</span>
                </div>
            </div>
            <!-- Buttons -->
            <div class="flex gap-2">
                <button id="start-btn" class="min-w-[52px] min-h-[44px] px-4 py-2 rounded-xl bg-gradient-to-b from-revolution to-red-700 text-white font-heading font-bold border-3 border-red-800 shadow-md active:shadow-sm active:translate-y-0.5 transition-all duration-100 cursor-pointer focus:outline-none focus:ring-2 focus:ring-red-300">
                    <svg class="w-5 h-5 mx-auto" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                </button>
                <button id="stop-btn" class="min-w-[52px] min-h-[44px] px-4 py-2 rounded-xl bg-gradient-to-b from-slate-100 to-slate-200 text-slate-500 font-heading font-bold border-3 border-slate-300 shadow-md active:shadow-sm active:translate-y-0.5 transition-all duration-100 cursor-pointer focus:outline-none focus:ring-2 focus:ring-slate-300">
                    <svg class="w-5 h-5 mx-auto" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
                </button>
            </div>
        </div>
        <!-- Health bar (L√≤ng d√¢n) -->
        <div class="mt-2 flex items-center gap-2">
            <span class="text-xs font-semibold text-slate-500">L√≤ng d√¢n</span>
            <div class="flex-1 h-2 rounded-full bg-slate-200 overflow-hidden">
                <div id="health-bar" class="h-full bg-gradient-to-r from-ally to-gold w-full transition-all duration-300 rounded-full"></div>
            </div>
            <span id="health-label" class="text-xs font-bold text-ally">100%</span>
        </div>
    </div>

    <!-- START MODAL - Mission Briefing -->
    <div id="start-modal" class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="modal-content bg-white rounded-3xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto transform scale-95 transition-transform duration-300 border-4 border-revolution">
            <!-- Header -->
            <div class="bg-gradient-to-r from-revolution to-red-700 px-6 py-5 text-white">
                <div class="flex items-center justify-center gap-3">
                    <svg class="w-10 h-10 text-gold" viewBox="0 0 24 24" fill="currentColor"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></svg>
                    <div class="text-center">
                        <h2 id="briefing-title" class="text-2xl sm:text-3xl font-heading font-extrabold">NHI·ªÜM V·ª§ C·ª¶A B·∫†N</h2>
                        <p id="briefing-subtitle" class="text-gold/90 font-semibold">B·∫£o v·ªá Th√†nh qu·∫£ C√°ch m·∫°ng</p>
                    </div>
                    <svg class="w-10 h-10 text-gold" viewBox="0 0 24 24" fill="currentColor"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></svg>
                </div>
            </div>
            
            <!-- Content -->
            <div class="p-6 space-y-5">
                <!-- Intro paragraphs -->
                <div id="briefing-paragraphs" class="space-y-3 text-slate-700 leading-relaxed">
                    <!-- Populated by JS -->
                </div>
                
                <!-- Entity Legend Grid -->
                <div class="grid sm:grid-cols-2 gap-4">
                    <!-- Enemies -->
                    <div class="bg-enemy/5 border-2 border-enemy/30 rounded-2xl p-4">
                        <h3 class="font-heading font-bold text-enemy mb-3 flex items-center gap-2">
                            <span class="text-xl">üéØ</span> GI·∫∂C N·ªòI X√ÇM <span class="text-xs font-normal">(ƒê·∫≠p!)</span>
                        </h3>
                        <div id="enemy-legend" class="space-y-2">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    <!-- Allies -->
                    <div class="bg-ally/5 border-2 border-ally/30 rounded-2xl p-4">
                        <h3 class="font-heading font-bold text-ally mb-3 flex items-center gap-2">
                            <span class="text-xl">üõ°Ô∏è</span> ƒê·ªòNG L·ª∞C <span class="text-xs font-normal">(B·∫£o v·ªá!)</span>
                        </h3>
                        <div id="ally-legend" class="space-y-2">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
                
                <!-- Rules -->
                <div class="bg-slate-50 rounded-2xl p-4 border-2 border-slate-200">
                    <h3 class="font-heading font-bold text-slate-700 mb-2">üìã Quy t·∫Øc ch·∫•m ƒëi·ªÉm</h3>
                    <ul id="briefing-rules" class="space-y-1 text-sm text-slate-600">
                        <!-- Populated by JS -->
                    </ul>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="px-6 pb-6">
                <button id="modal-start-btn" class="w-full py-4 bg-gradient-to-b from-revolution to-red-700 hover:from-red-600 hover:to-red-800 text-white text-xl font-heading font-extrabold rounded-2xl border-4 border-red-800 shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-red-300">
                    üöÄ B·∫ÆT ƒê·∫¶U NHI·ªÜM V·ª§
                </button>
            </div>
        </div>
    </div>

    <!-- END MODAL - Debrief -->
    <div id="end-modal" class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="modal-content bg-white rounded-3xl shadow-2xl max-w-lg w-full transform scale-95 transition-transform duration-300 border-4 border-worker overflow-hidden">
            <!-- Header with dynamic color -->
            <div id="debrief-header" class="px-6 py-5 text-white bg-gradient-to-r from-worker to-blue-700">
                <div class="text-center">
                    <div id="debrief-icon" class="text-5xl mb-2">‚≠ê</div>
                    <h2 id="debrief-title" class="text-3xl font-heading font-extrabold">K·∫æT QU·∫¢</h2>
                </div>
            </div>
            
            <!-- Stats -->
            <div class="p-6 space-y-4">
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-revolution/10 rounded-xl p-3 text-center border-2 border-revolution/30">
                        <p class="text-xs text-slate-500 font-semibold">ƒêi·ªÉm s·ªë</p>
                        <p id="final-score" class="text-2xl font-heading font-extrabold text-revolution">0</p>
                    </div>
                    <div class="bg-ally/10 rounded-xl p-3 text-center border-2 border-ally/30">
                        <p class="text-xs text-slate-500 font-semibold">ƒê·ªô ch√≠nh x√°c</p>
                        <p id="final-accuracy" class="text-2xl font-heading font-extrabold text-ally">0%</p>
                    </div>
                    <div class="bg-worker/10 rounded-xl p-3 text-center border-2 border-worker/30">
                        <p class="text-xs text-slate-500 font-semibold">Gi·∫∑c b·ªã di·ªát</p>
                        <p id="final-enemies" class="text-2xl font-heading font-extrabold text-worker">0</p>
                    </div>
                    <div class="bg-construction/10 rounded-xl p-3 text-center border-2 border-construction/30">
                        <p class="text-xs text-slate-500 font-semibold">L√≤ng d√¢n c√≤n</p>
                        <p id="final-health" class="text-2xl font-heading font-extrabold text-construction">0%</p>
                    </div>
                </div>
                
                <!-- Message -->
                <div class="text-center">
                    <p id="debrief-message" class="text-lg font-semibold text-slate-700 mb-2">B·∫°n ƒë√£ ho√†n th√†nh nhi·ªám v·ª•!</p>
                </div>
                
                <!-- Quote -->
                <div class="bg-gold/20 border-l-4 border-gold rounded-r-xl p-4">
                    <p class="text-sm italic text-slate-600">
                        <span class="text-gold font-bold">‚ùù</span>
                        <span id="debrief-quote">C·∫ßn, Ki·ªám, Li√™m, Ch√≠nh l√† n·ªÅn t·∫£ng c·ªßa ƒë·ªùi s·ªëng m·ªõi.</span>
                        <span class="text-gold font-bold">‚ùû</span>
                    </p>
                    <p class="text-right text-xs text-slate-500 mt-1 font-semibold">‚Äî H·ªì Ch√≠ Minh</p>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="px-6 pb-6 flex gap-3">
                <button id="modal-replay-btn" class="flex-1 py-3 bg-gradient-to-b from-revolution to-red-700 hover:from-red-600 hover:to-red-800 text-white font-heading font-bold rounded-xl border-3 border-red-800 shadow-md hover:shadow-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-red-300">
                    üîÑ Ch∆°i l·∫°i
                </button>
                <button id="modal-close-btn" class="flex-1 py-3 bg-gradient-to-b from-slate-100 to-slate-200 hover:from-slate-200 hover:to-slate-300 text-slate-600 font-heading font-bold rounded-xl border-3 border-slate-300 shadow-md hover:shadow-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-slate-300">
                    ‚úï ƒê√≥ng
                </button>
            </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script src="app.js"></script>
</body>
</html>